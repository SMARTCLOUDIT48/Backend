<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Musubi - 마이페이지</title>

    <link rel="stylesheet" th:href="@{/css/member/mypage.css}" />
    <link rel="stylesheet" th:href="@{/css/member/interest.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}">

    <script th:inline="javascript">
        /*<![CDATA[*/
        const CONTEXT_PATH = /*[[@{/}]]*/ "/";
        /*]]>*/
    </script>
    <script type="module" th:src="@{/js/member/mypage.js}"></script>

</head>

<body>

    <div th:replace="~{fragments/header :: header}"></div>

    <main class="page">
        <section class="shell">

            <!-- 타이틀 영역 -->
            <div class="page-hero glass">
                <h1>마이페이지</h1>
                <p>나의 프로필 · 친구 추천 · 매너 온도 · 인기도를 한눈에 관리하세요.</p>
            </div>

            <!-- 메인 그리드 -->
            <section class="grid">

                <!-- LEFT -->
                <aside class="sidebar">

                    <!-- 국적 + 언어 한 줄 -->
                    <!-- 프로필 카드 -->
                    <div class="glass card profile-card">

                        <!-- 프로필 이미지 -->
                        <div class="avatar-wrap">
                            <label>
                                <input type="file" id="profileImageInput" accept="image/*" hidden />
                                <img id="profileImage" class="avatar" src="/images/profile/default.png" alt="profile" />
                            </label>

                            <button class="avatar-btn" type="button" title="프로필 사진 변경"
                                onclick="document.getElementById('profileImageInput').click()">
                                📷
                            </button>
                        </div>

                        <!-- 프로필 메타 -->
                        <div class="profile-meta">

                            <!-- 닉네임 + 나이 + 국적 -->
                            <h3 class="nickname">
                                <span id="nickname">닉네임</span>
                                <span id="age" class="age">(24)</span>
                                <span id="nationFlag">🇰🇷</span>
                            </h3>

                            <div class="likeAndProfileContainer">
                                <div class="like-dislike">
                                    <button id="likeBtn" class="likeBtn">
                                        👍 <span id="likeCount">0</span>
                                    </button>
                                    <button id="dislikeBtn" class="likeBtn">
                                        👎
                                    </button>
                                </div>

                                <button id="openProfileModal" class="btn btn-profile" type="button">
                                    프로필 수정
                                </button>
                            </div>
                            <!--  언어 라인 (핵심 구조) -->
                            <div class="profile-lang-block">

                                <!-- 1줄: 언어 흐름 + 레벨 -->
                                <div class="lang-line">
                                    <span id="nativeLang" class="lang-flag">🇰🇷</span>
                                    <span class="arrow">→</span>
                                    <span id="studyLang" class="lang-flag">🇯🇵</span>
                                    <span id="levelLanguage" class="level-text">Intermediate</span>
                                </div>

                                <!-- 2줄: 매너 온도 -->
                                <div class="manner-line" data-value="36.5">
                                    <div class="manner-fill"></div>
                                    <span id="manner" class="manner"></span>
                                </div>

                            </div>


                        </div>

                        <!-- 자기소개 -->
                        <!-- 자기소개 -->
                        <div class="glass card profile-card">
                            <div class="profile-intro">
                                <p id="intro"></p>
                            </div>
                        </div>


                    </div>
                    </div>



                    <!-- 2 메뉴 -->
                    <nav class="glass card menu">
                        <a class="menu-item active" href="#">
                            <span class="mi-ico">👤</span><span>프로필</span>
                        </a>
                        <a class="menu-item" href="#">
                            <span class="mi-ico">📘</span><span>내 게시글</span>
                        </a>
                        <a class="menu-item" th:href="@{/chat}">
                            <span class="mi-ico">💬</span><span>채팅</span>
                        </a>
                        <a class="menu-item" href="#">
                            <span class="mi-ico">⚙️</span><span>계정 관리</span>
                        </a>
                    </nav>

                    <!-- 3 작은 카드 : 최근 대화 -->
                    <div class="glass card mini-card">
                        <div class="mini-head">
                            <h4>💬 최근 대화</h4>
                            <span class="mini-pill" style="cursor:pointer" onclick="location.href='/chat'">
                                더보기
                            </span>
                        </div>

                        <div id="recentChatList">

                            <div class="mini-row">
                                <div class="mini-avatar">👤</div>
                                <div class="mini-text">
                                    <div class="mini-name">최근 대화가 없습니다</div>
                                    <div class="mini-sub">채팅을 시작해보세요</div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- 4 작은 카드 : 관심사 -->
                    <div class="glass card mini-card">
                        <div class="mini-head">
                            <h4>관심사</h4>
                            <button id="openInterestModal" class="btn btn-member">수정</button>
                        </div>

                        <!-- JS가 전부 채울 영역 -->
                        <div class="chip-wrap" id="interestChips">
                            <!-- JS renderChips()로 동적 생성 -->
                        </div>
                    </div>



                </aside>


                <!-- RIGHT -->
                <section class="content">

                    <!-- 추천 카드 -->
                    <div class="glass card content-card">
                        <div class="card-head">
                            <div>
                                <h2>관심사에 맞는 친구 추천</h2>
                                <p>내 관심사에 맞는 친구를 추천해드려요.</p>
                            </div>
                            <button type="button" class="btn btn-member" onclick="location.href='/recommend'">
                                더보기
                            </button>
                        </div>

                        <div class="reco-grid" id="recommendGrid"></div>

                    </div>

                    <!-- 중간 2단 카드 -->
                    <!-- ===============================
                  2. 중간 통계 (2단)
                =============================== -->
                    <div class="stats">

                        <!-- 내 프로필을 본 사람 -->
                        <div class="glass card stat-card">
                            <div class="stat-head">
                                <h3>내 프로필을 본 사람</h3>
                                <span class="muted">최근 방문</span>
                            </div>

                            <div class="profile-view-list" id="profileViewList">
                                <!-- JS로 렌더링 -->
                                <p class="muted">아직 방문자가 없습니다.</p>
                            </div>
                        </div>

                        <!-- 내 프로필을 좋아요한 사람 -->
                        <div class="glass card stat-card">
                            <div class="stat-head">
                                <h3>내 프로필을 좋아요한 사람</h3>
                                <span class="muted">최근 좋아요</span>
                            </div>

                            <div class="profile-view-list" id="likedMeList">
                                <p class="muted">아직 좋아요가 없습니다.</p>
                            </div>
                        </div>

                    </div>

                    <!-- ===============================
                  3. 게시글 통계 (하단 단일 카드)
                =============================== -->
                    <div class="glass card content-card stat-card">

                        <div class="stat-head">
                            <h3>통계</h3>
                            <span class="muted">누적</span>
                        </div>

                        <div class="stat-body">
                            <div class="stat-item posts">
                                <span class="stat-label">📝 게시글</span>
                                <span class="stat-value" id="postCount">0</span>
                            </div>


                            <div class="stat-extra">
                                <span class="extra-label">💌 오늘 연락 중인 이성</span>
                                <span id="hotLevel" class="hot-level"></span>
                                <strong class="extra-value" id="chattingCount">0</strong>
                                <span class="extra-unit">명</span>
                            </div>

                        </div>


                        <div class="stat-body hot-row">

                            <div class="stat-item hot-1">
                                <span class="stat-value">지금 대화하면 칼답 가능성! ✨</span>
                                <span class="stat-label">0명</span>
                            </div>
                            <div class="stat-item hot-2">

                                <span class="stat-value">오늘 대화 분위기가 좋은 분이네요 💬</span>
                                <span class="stat-label">1~4명</span>
                            </div>

                            <div class="stat-item hot-3">

                                <span class="stat-value">인기멤버에요! 🔥</span>
                                <span class="stat-label">5~10명</span>
                            </div>

                            <div class="stat-item hot-4">

                                <span class="stat-value">인플루언서급이에요! 👑</span>
                                <span class="stat-label">11명+</span>
                            </div>

                        </div>
                    </div>


                </section>
            </section>
        </section>
    </main>

    <!-- ================= 프로필 수정 모달 ================= -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-container glass">

            <h3 class="modal-name">프로필 수정</h3>

            <form id="profileForm">

                <!-- 자기소개 -->
                <textarea name="intro" placeholder="자기소개"></textarea>



                <!-- 언어 레벨 -->
                <select name="levelLanguage">
                    <option value="BEGINNER">Beginner</option>
                    <option value="INTERMEDIATE">Intermediate</option>
                    <option value="ADVANCED">Advanced</option>
                    <option value="NATIVE">Native</option>
                </select>


                <div class="modal-actions">
                    <button type="submit" class="btn btn-glass">저장</button>
                    <button type="button" id="closeProfileModal" class="btn btn-soft">취소</button>
                </div>

            </form>
        </div>
    </div>
    <!-- ================================================== -->

    <!-- 관심사 수정 모달 -->
    <div id="interestModal" class="modal hidden">
        <div class="modal-overlay"></div>

        <div class="modal-content glass">
            <h3>관심사 수정</h3>
            <p>관심 있는 주제를 최대 5개까지 선택해 주세요.</p>


            <div class="interest-grid">

                <!-- 1. 문화 · 예술 -->
                <div class="interest-group">
                    <h3>🎨 문화 · 예술</h3>
                    <button class="interest-item" data-interest="CULTURE" data-detail="MOVIE">영화</button>
                    <button class="interest-item" data-interest="CULTURE" data-detail="DRAMA">드라마</button>
                    <button class="interest-item" data-interest="CULTURE" data-detail="MUSIC">음악</button>
                    <button class="interest-item" data-interest="CULTURE" data-detail="EXHIBITION">전시 · 미술관</button>
                    <button class="interest-item" data-interest="CULTURE" data-detail="PERFORMANCE">공연 · 연극</button>
                </div>

                <!-- 취미 · 여가 -->
                <div class="interest-group">
                    <h3>🎮 취미 · 여가</h3>
                    <button class="interest-item" data-interest="HOBBY" data-detail="PHOTO">사진</button>
                    <button class="interest-item" data-interest="HOBBY" data-detail="GAME">게임</button>
                    <button class="interest-item" data-interest="HOBBY" data-detail="BOARD_GAME">보드게임</button>
                    <button class="interest-item" data-interest="HOBBY" data-detail="DIY">DIY · 만들기</button>
                    <button class="interest-item" data-interest="HOBBY" data-detail="COLLECT">수집</button>
                </div>

                <!-- 운동 · 스포츠 -->
                <div class="interest-group">
                    <h3>⚽ 운동 · 스포츠</h3>
                    <button class="interest-item" data-interest="SPORTS" data-detail="FITNESS">헬스</button>
                    <button class="interest-item" data-interest="SPORTS" data-detail="RUNNING">러닝</button>
                    <button class="interest-item" data-interest="SPORTS" data-detail="YOGA">요가</button>
                    <button class="interest-item" data-interest="SPORTS" data-detail="BALL_SPORTS">구기 스포츠</button>
                    <button class="interest-item" data-interest="SPORTS" data-detail="HIKING">등산</button>
                </div>

                <!-- 여행 -->
                <div class="interest-group">
                    <h3>✈️ 여행 · 지역</h3>
                    <button class="interest-item" data-interest="TRAVEL" data-detail="DOMESTIC_TRAVEL">국내 여행</button>
                    <button class="interest-item" data-interest="TRAVEL" data-detail="OVERSEAS_TRAVEL">해외 여행</button>
                    <button class="interest-item" data-interest="TRAVEL" data-detail="BACKPACKING">배낭여행</button>
                    <button class="interest-item" data-interest="TRAVEL" data-detail="FOOD_TRIP">맛집 탐방</button>
                    <button class="interest-item" data-interest="TRAVEL" data-detail="LOCAL_TOUR">로컬 투어</button>
                </div>

                <!-- 음식 -->
                <div class="interest-group">
                    <h3>🍳 음식 · 요리</h3>
                    <button class="interest-item" data-interest="FOOD" data-detail="COOKING">요리</button>
                    <button class="interest-item" data-interest="FOOD" data-detail="BAKING">베이킹</button>
                    <button class="interest-item" data-interest="FOOD" data-detail="CAFE">카페</button>
                    <button class="interest-item" data-interest="FOOD" data-detail="ALCOHOL">술</button>
                    <button class="interest-item" data-interest="FOOD" data-detail="GOURMET">미식</button>
                </div>

                <!-- 학습 -->
                <div class="interest-group">
                    <h3>📚 학습 · 자기계발</h3>
                    <button class="interest-item" data-interest="STUDY" data-detail="LANGUAGE_STUDY">언어 학습</button>
                    <button class="interest-item" data-interest="STUDY" data-detail="CERTIFICATE">자격증</button>
                    <button class="interest-item" data-interest="STUDY" data-detail="READING">독서</button>
                    <button class="interest-item" data-interest="STUDY" data-detail="STUDY_GROUP">스터디</button>
                    <button class="interest-item" data-interest="STUDY" data-detail="CAREER">커리어</button>
                </div>

                <!-- IT -->
                <div class="interest-group">
                    <h3>💻 IT · 기술</h3>
                    <button class="interest-item" data-interest="IT" data-detail="PROGRAMMING">프로그래밍</button>
                    <button class="interest-item" data-interest="IT" data-detail="WEB_APP">웹·앱 개발</button>
                    <button class="interest-item" data-interest="IT" data-detail="GAME_DEV">게임 개발</button>
                    <button class="interest-item" data-interest="IT" data-detail="AI_DATA">AI · 데이터</button>
                    <button class="interest-item" data-interest="IT" data-detail="IT_TREND">IT 트렌드</button>
                </div>

                <!-- 라이프스타일 -->
                <div class="interest-group">
                    <h3>🏡 라이프스타일</h3>
                    <button class="interest-item" data-interest="LIFESTYLE" data-detail="DAILY">일상</button>
                    <button class="interest-item" data-interest="LIFESTYLE" data-detail="PET">반려동물</button>
                    <button class="interest-item" data-interest="LIFESTYLE" data-detail="FASHION">패션</button>
                    <button class="interest-item" data-interest="LIFESTYLE" data-detail="INTERIOR">인테리어</button>
                    <button class="interest-item" data-interest="LIFESTYLE" data-detail="WELLNESS">건강</button>
                </div>

            </div>


            <div class="modal-actions">
                <button id="saveInterestBtn" class="btn btn-glass">저장</button>
                <button id="closeInterestBtn" class="btn btn-soft">취소</button>
            </div>
        </div>
    </div>



    <div th:replace="~{fragments/footer :: footer}"></div>

</body>
<script th:src="@{/js/member/logout.js}"></script>
<script th:src="@{/js/member/interestModal.js}"></script>

</html>