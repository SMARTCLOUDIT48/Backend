<header th:fragment="header"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
        class="header">

    <div class="header-inner">

        <!-- 로고 -->
        <div class="logo" th:onclick="|location.href='@{/}'|">
            <img th:src="@{/images/homeimgs/Logo_3.png}" alt="Musubi Logo" class="logo-img">
        </div>

        <!-- ✅ 전역 알림용: 로그인한 내 userId (전 페이지 공통) -->
        <div sec:authorize="isAuthenticated()" style="display:none;">
            <input type="hidden" id="globalMyUserId" th:value="${#authentication.principal.user.id}">
        </div>

        <!-- 네비게이션 -->
        <nav class="nav">
            <a th:href="@{/community}">커뮤니티</a>
            <a th:href="@{/recommend}">파트너찾기</a>

            <!-- ✅ 채팅 메뉴 + 헤더 🔴 -->
            <a th:href="@{/chat}" class="nav-chat-link">
                채팅
                <span id="headerUnreadDot" style="display:none;"></span>
            </a>

            <a th:href="@{/customer/inquiry}">1:1문의</a>
            <a th:href="@{/customer/notice}">고객센터</a>
        </nav>

        <!-- 인증 버튼 영역 -->
        <div class="auth-buttons">

            <!-- 비로그인 상태 -->
            <div sec:authorize="isAnonymous()">
                <button class="login-btn" type="button"
                        th:onclick="|location.href='@{/login}'|">
                    로그인
                </button>

                <button class="signup-btn" type="button"
                        th:onclick="|location.href='@{/member/signup}'|">
                    회원가입
                </button>
            </div>

            <!-- 로그인 상태 -->
            <div sec:authorize="isAuthenticated()">

                <!-- 관리자 로그인 시 -->
                <button class="signup-btn" type="button"
                        sec:authorize="hasAuthority('ADMIN')"
                        th:onclick="|location.href='@{/admin/dashboard}'|">
                    관리자 대시보드
                </button>


                <!-- 관리자 아닐 경우 (일반 유저) -->
                <button class="signup-btn" type="button"
                        sec:authorize="!hasAuthority('ADMIN')"
                        th:onclick="|location.href='@{/member/mypage}'|">
                    마이페이지
                </button>

                <button class="login-btn" type="button" onclick="logout()">
                    로그아웃
                </button>
            </div>

        </div>
    </div>

    <!-- 로그아웃 JS -->
    <script th:src="@{/js/member/logout.js}"></script>

    <!-- ✅ SockJS / STOMP는 먼저 로드 (defer X 권장) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <!-- ✅ 전역 헤더 알림 JS -->
    <script th:src="@{/js/common/header-notify.js}" defer></script>

</header>
