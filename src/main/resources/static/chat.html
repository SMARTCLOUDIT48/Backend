<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì±„íŒ… í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>ğŸš€ ì±„íŒ…ë°© ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
<button onclick="connect()">ì—°ê²°í•˜ê¸°</button>
<button onclick="disconnect()">ì—°ê²°ëŠê¸°</button>
<hr>
<div>
    <input type="text" id="msg" placeholder="ë©”ì‹œì§€ ì…ë ¥">
    <button onclick="sendMessage()">ë³´ë‚´ê¸°</button>
</div>
<ul id="messageList"></ul>

<script>
    var stompClient = null;

    function connect() {
        // SockJS ì—†ì´ ìŒ© WebSocketìœ¼ë¡œ ì—°ê²° (íŒ€ì¥ë‹˜ ì„¤ì •ì— ë§ì¶¤)
        var socket = new WebSocket('ws://localhost:8080/ws/chat');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            alert("âœ… ì—°ê²° ì„±ê³µ!");

            // êµ¬ë…(Subscribe) - ë°© ë²ˆí˜¸ 1ë²ˆì´ë¼ê³  ê°€ì •
            stompClient.subscribe('/sub/chat/room/1', function (message) {
                showUi(JSON.parse(message.body));
            });

            // ì…ì¥ ë©”ì‹œì§€ ì „ì†¡
            stompClient.send("/pub/chat/message", {}, JSON.stringify({
                type: 'ENTER',
                roomId: '1',
                sender: 'íŒ€ì¥ë‹˜',
                message: ''
            }));
        });
    }

    function sendMessage() {
        var msgContent = document.getElementById('msg').value;
        stompClient.send("/pub/chat/message", {}, JSON.stringify({
            type: 'TALK',
            roomId: '1',
            sender: 'íŒ€ì¥ë‹˜',
            message: msgContent
        }));
    }

    function disconnect() {
        if (stompClient !== null) {
            stompClient.disconnect();
        }
        console.log("Disconnected");
    }

    function showUi(message) {
        var ul = document.getElementById("messageList");
        var li = document.createElement("li");
        li.appendChild(document.createTextNode(message.sender + ": " + message.message));
        ul.appendChild(li);
    }
</script>
</body>
</html>